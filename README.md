# Open in Safari (Edge → Mac via Parallels)

Open the current Microsoft Edge tab (running in Windows inside Parallels) directly in Safari on your Mac.

This repo provides:
- A macOS helper (zsh orchestrator + Python 3 server) that safely accepts open-URL requests and launches Safari.
- A Microsoft Edge extension that sends the current page URL to the Mac helper.
- A vector icon (SVG) plus auto-generation of PNG sizes used by the Edge extension.

Tested assumptions:
- macOS: Apple Silicon (Monterey 12+ recommended), Python 3 available at /usr/bin/python3.
- Parallels Desktop with Parallels Tools installed; Windows guest can reach the Mac host IP on the Parallels virtual network (e.g., 10.211.55.2).
- Microsoft Edge (Chromium-based) on Windows.

Security:
- The macOS helper binds to your Mac only and validates:
  - Source IP is in allowed Parallels subnets (default 10.211.55.0/24, 10.37.129.0/24).
  - A shared token must match (configurable).
- CORS headers are enabled for the Edge extension to call the helper.

Quick start

1) On your Mac (host):
- Double-click mac/open_in_safari.command
- It will:
  - Build the extension icons from extension/icons/icon.svg (produces 16/32/48/128 PNGs)
  - Start the Python server
  - Install a LaunchAgent to run the server at login
  - Show a dialog with the detected Mac host IP(s), port, and token

2) In Windows (guest), install the Edge extension:
- Edge → Extensions → Manage Extensions → Developer mode: On
- Load unpacked → select the extension/ folder in this repo

3) Configure the extension:
- Open the extension’s Options page
- Set the Host IP to the one shown by the mac script dialog (e.g., 10.211.55.2)
- Port should match (default 51888)
- Token should match
- Click “Test Connection” (should succeed)

4) Use it:
- Click the toolbar button “Open in Safari (Mac)”, or
- Right-click a page/link/image and choose “Open in Safari (Mac)”, or
- Use the shortcut Alt+Shift+S

Files

- mac/open_in_safari.command
  - Double-click to install/start the macOS helper and LaunchAgent.
  - Also generates the PNG icons for the extension from extension/icons/icon.svg.
- mac/open_in_safari_server.py
  - Python 3 HTTP server that receives requests and opens Safari.
- mac/launch/com.phobrla.open-in-safari.plist
  - LaunchAgent template (the .command script installs a resolved copy to ~/Library/LaunchAgents).
- extension/
  - manifest.json: Edge extension manifest (MV3)
  - background.js: Service worker (button, context menus, messaging)
  - options.html/.js/.css: Options UI to set host, port, token, HTTPS
  - icons/
    - icon.svg: Safari SF Symbol (provided by you)
    - icon16.png, icon32.png, icon48.png, icon128.png (auto-generated by the mac script)

Configuration

- mac/open_in_safari.command has a CONFIG section at top:
  - PORT, BIND_ADDRESS, ALLOWED_SUBNETS, SHARED_TOKEN, INSTALL_LAUNCH_AGENT, DRY_RUN, VERBOSE
- mac/open_in_safari_server.py has its own CONFIG with environment overrides:
  - Environment vars set by the LaunchAgent (OIS_PORT, OIS_BIND, OIS_TOKEN, OIS_ALLOWED_SUBNETS) override the Python defaults.
- extension/options page stores settings in chrome.storage.sync with defaults:
  - Host: 10.211.55.2
  - Port: 51888
  - Token: changeme123456
  - HTTPS: off

Notes

- Host IP in Parallels:
  - Common defaults are 10.211.55.2 or 10.37.129.2 on vnic0/vnic1. The Mac script detects and lists these for you.
- Firewall:
  - The helper listens on the Mac; outbound from Windows (guest) typically succeeds by default.
  - If you use third-party firewall software on macOS, allow inbound TCP to the chosen port.
- Elevated privileges:
  - Not required. LaunchAgent runs in your user context.

Icons

- The extension uses PNG icons at 16/32/48/128 px. These are generated from extension/icons/icon.svg when you run mac/open_in_safari.command.
- Current icon: Apple’s SF Symbol for Safari (provided by you).
  - Usage note: “This symbol may not be modified and may only be used to refer to Apple’s Safari browser.” Ensure your use complies with Apple’s license.

Uninstall

- mac: Double-click the .command script again; choose to remove the LaunchAgent, or manually:
  - launchctl bootout gui/$UID ~/Library/LaunchAgents/com.phobrla.open-in-safari.plist
  - Remove the plist file
- Windows: Remove the extension in Edge.

References

- Python http.server: https://docs.python.org/3/library/http.server.html
- Python ipaddress: https://docs.python.org/3/library/ipaddress.html
- macOS open command: https://ss64.com/osx/open.html
- LaunchAgents: https://www.launchd.info
- Edge/Chrome Extensions (Manifest V3):
  - https://developer.chrome.com/docs/extensions/mv3/
  - https://learn.microsoft.com/microsoft-edge/extensions-chromium/